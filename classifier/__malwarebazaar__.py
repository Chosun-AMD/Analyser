import hashlib
import requests
from pprint import pprint

class MalwareBazaar:
    def __init__(self) -> None:
        self._api = 'https://mb-api.abuse.ch/api/v1/'

    def __call__(self, filename):
        sha256 = hashlib.sha256(open(filename, 'rb').read()).hexdigest()
        datas = {
            'query': 'get_info',
            'hash': sha256
        }
        report = requests.post(self._api, data=datas).json()
        if report['query_status'] == 'hash_not_found':
            signature = 'Not Found'
            threat_name = 'Not Found'
        else:
            signature = report['data'][0]['signature']
            signature = 'Not Found' if signature is None else signature
            threat_name = report['data'][0]['vendor_intel']['ReversingLabs']['threat_name']
            threat_name = 'Not Found' if threat_name is None else threat_name
        return {'signature': signature, 'threat_name': threat_name}